# Uninstall script for the project

if(NOT EXISTS "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
  message(FATAL_ERROR "Cannot find install manifest: @CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
endif()

file(READ "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt" files)
string(REGEX REPLACE "\n" ";" "${files}" files)
list(REVERSE files)

foreach(file ${files})
  message(STATUS "Uninstalling: $ENV{DESTDIR}${file}")
  
  if(EXISTS "$ENV{DESTDIR}${file}" OR IS_SYMLINK "$ENV{DESTDIR}${file}")
    file(REMOVE_RECURSE "$ENV{DESTDIR}${file}")
    
    # Remove parent directories if they become empty
    get_filename_component(dirpath "$ENV{DESTDIR}${file}" PATH)
    get_filename_component(name "$ENV{DESTDIR}${file}" NAME)
    
    while(IS_DIRECTORY "${dirpath}" 
          AND NOT "${dirpath}" STREQUAL "/" 
          AND NOT "${dirpath}" STREQUAL "$ENV{DESTDIR}")
      
      file(GLOB contents "${dirpath}/*")
      list(LENGTH contents n)
      
      if(NOT n)
        message(STATUS "Removing empty directory: ${dirpath}")
        file(REMOVE_RECURSE "${dirpath}")
      else()
        break()
      endif()
      
      get_filename_component(dirpath "${dirpath}" PATH)
    endwhile()
  else()
    message(STATUS "File does not exist: $ENV{DESTDIR}${file}")
  endif()
  
endforeach()

message(STATUS "Uninstall completed")
